# CSharp.SourceGen.Scriban

A C# source generator that renders [Scriban](https://github.com/scriban/scriban) templates.

- [Installation](#installation)
- [Source generation](#source-generation)
- [Saving generated files](#saving-generated-files)
- [Limitations](#limitations)
- [Example](#example)


## Installation

```text
dotnet add package Dartk.CSharp.SourceGen.Scriban
```

To avoid propagating dependency on the package set the option `PrivateAssets="all"` in the project file:

```xml
<ItemGroup>
    <PackageReference Include="Dartk.CSharp.SourceGen.Scriban"
                      Version="0.1.0-alpha1"
                      PrivateAssets="All" />
</ItemGroup>
```

## Source generation

Include scriban template files with `.scriban` extension to the project as `AdditionalFiles`.

> **Warning**: If a `.scriban` file's name starts with an underscore '_', then it will not be rendered. But it can be included in other templates using the [`include`](https://github.com/scriban/scriban/blob/master/doc/language.md#911-include-name-arg1argn) statement.

For example, to render all scriban templates in the `ScribanTemplates` folder add this to the project file:

```xml

<ItemGroup>
    <AdditionalFiles Include="ScribanTemplates/**" />
</ItemGroup>
```

Go to a [complete example](#example) below for more information.


## Saving generated files

To save the generated source files set properties `EmitCompilerGeneratedFiles` and `CompilerGeneratedFilesOutputPath` in the project file:

```xml
<PropertyGroup>
    <EmitCompilerGeneratedFiles>true</EmitCompilerGeneratedFiles>
    <!--Generated files will be saved to 'obj\GeneratedFiles' folder-->
    <CompilerGeneratedFilesOutputPath>$(BaseIntermediateOutputPath)\GeneratedFiles</CompilerGeneratedFilesOutputPath>
</PropertyGroup>
```


## Limitations

Passing parameters to scriban templates is not supported.


## Example

Create a new console C# project:

```text
dotnet new console Example.SourceGenScriban
```

Install the package `Dartk.CSharp.SourceGen.Scriban` and set the property `PrivateAssets="All"` by editing the project file `Example.SourceGenScriban.csproj`:

```xml
<ItemGroup>
    <PackageReference Include="Dartk.CSharp.SourceGen.Scriban"
                      Version="0.1.0-alpha1"
                      PrivateAssets="All"/>
</ItemGroup>
```

Create a `ScribanTemplates` folder in the project directory and include files within as `AdditionalFiles`:

```xml
<ItemGroup>
    <AdditionalFiles Include="ScribanTemplates/**" />
</ItemGroup>
```

Add the following files to the `ScribanTemplates` folder:

`_global.scriban`

```liquid
{{
# File name starts with an underscore, therefore will not be rendered.
# But it can be included in other templates.

global_values = [ "one", "two", "three", "four" ]
}}
```

`generated-values.scriban`

```liquid
{{- include '_global.scriban'    # include statement is supported -}}

/// <summary>
/// Generated by 'generated-values.scriban'
/// </summary>
public static class GeneratedValues
{
    {{- for value in global_values    # using variable 'global_values' from '_global.scriban' }}
    public const string {{ string.capitalize value }} = "{{ value }}";
    {{- end }}
}
```

The generator will skip `_global.scriban` and render `generated-values.scriban`:

```c#
/// <summary>
/// Generated by 'generated-values.scriban'
/// </summary>
public static class GeneratedValues
{
    public const string One = "one";
    public const string Two = "two";
    public const string Three = "three";
    public const string Four = "four";
}
```

Now `GeneratedValues` class can be used in your code.

Put this in the `Program.cs`:

```c#
Console.WriteLine(GeneratedValues.One);
Console.WriteLine(GeneratedValues.Two);
Console.WriteLine(GeneratedValues.Three);
Console.WriteLine(GeneratedValues.Four);
```

It will write the following:

```text
one
two
three
four
```

